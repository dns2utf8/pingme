<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <title>Ping Me (Test Renderer)</title>
    
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script>
      var chartsLoaded = false

      google.charts.load('current', {packages: ['corechart', 'line']});
      google.charts.setOnLoadCallback(function () { chartsLoaded = true });

      function renderPingSeries(pingJson) {

        if (!chartsLoaded) {
          statusElement.textContent = "chart library not yet available, please wait a bit..."
          return
        }

        // dump ping results into a data table
        var chartData = new google.visualization.DataTable();
        chartData.addColumn('number', 'seq');
        chartData.addColumn('number', 'RTT');

        console.log(pingJson)

        for (let pingResult of pingJson.results) {
          chartData.addRow([pingResult.seq, pingResult.rtt])
        }

        // label the axes
        var chartOptions = {
          hAxis: {
            title: 'Sequence'
          },
          vAxis: {
            title: 'RTT'
          }
        };

        // plot in the result div
        var chart = new google.visualization.LineChart(document.getElementById("result"));
        chart.draw(chartData, chartOptions);
      }

      function renderMe() {
        var dataURLElement = document.getElementById("data-url")
        var resultElement = document.getElementById("result")
        var statusElement = document.getElementById("status")

        var dataURL
        try {
          dataURL = new URL(dataURLElement.value)          
        } catch (error) {
          statusElement.textContext = "couldn't parse given URL; see console"
          console.log(error)
          return
        } 

        fetch(dataURL).then(function (response) {
          console.log(response)
          return response.json()
        }).then(function (json) {
          renderPingSeries(json)
          return true
        }).catch(function (error) {
          statusElement.textContent = "data retrieval from "+dataURL.toString()+" failed; see console"
          console.log(error)
          return false
        })
      }

    </script>
  </head>
  <body>
    <h1>Download cached ping data and render it</h1>
    <form>
      Data URL: <input type="url" id="data-url"></input>
      <input type="button" onclick="renderMe()" value="Render!"></button>
    </form>
    <div class="output" id="status">No render request pending.</div>    
    <div class="output" id="result">Results will appear here.</div>    
  </body>
</html>
